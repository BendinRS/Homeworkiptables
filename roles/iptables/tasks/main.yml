---
# tasks file for iptables

  - name: install packages
    yum:
      state: present
      name:
        - tcpdump
        - iptables
        - iptables-services

  - name: install packages centralRouter
    yum:
      state: present
      name:
        - epel-release
        - nginx
    when: (ansible_hostname == "centralServer")

  - name: enable nginx service centralRouter
    service:
      name: nginx
      state: started 
      enabled: yes
    when: (ansible_hostname == "centralServer")

  - name: disable default route
    lineinfile:
      dest: /etc/sysconfig/network-scripts/ifcfg-eth0
      line: DEFROUTE=no
    when: (ansible_hostname !== "inetRouter")

  - name: set up forward packages across routers
    sysctl:
      name: net.ipv4.conf.all.forwarding
      value: '1'
      state: present
    when: (ansible_hostname !== "centralServer")

  - name: copy route_inetRouter2
    template:
      src: ./files/route-eth1.inetRouter2
      dest: /etc/sysconfig/network-scripts/route-eth1
    when: (ansible_hostname == "inetRouter2")

  - name: copy centralServer
    template:
      src: ./files/route-eth1.centralServer
      dest: /etc/sysconfig/network-scripts/route-eth1
    when: (ansible_hostname == "centralServer")

  - name: restart network
    service:
      name: network
      state: restarted 


